{% set _menu_active = 'contrat' %}
{% extends 'base.html.twig' %}
{% block title %}Contrats{% endblock title %}
{% block body %}
    <ol class="breadcrumb">
        <li><a href="{{ path('contrat') }}">Contrat</a></li>
    </ol>
    
    <div class="row" id="searchable" data-type="contrat" data-url="{{ path('recherche_contrat')  }}" data-target="{{ path('contrat_visualisation', {'id': '_id_'})  }}">
	    <div class="col-xs-12">
	        <h3 style="margin-top: 10px;">Rechercher par contrat</h3>
	        {{ form_start(form, {'attr': { 'novalidate': 'novalidate', 'class': 'form-horizontal' } }) }}
	        <div class="form-group">
	            <div class="col-xs-10">
	                {{ form_errors(form.contrats) }}
	                {{ form_widget(form.contrats) }}
	            </div>
	            <div class="col-xs-2 text-right">
	            	<button type="submit" class="btn btn-default" type="button">Rechercher</button>
	            </div>
	        </div>
	        {{form_end(form)}}
	    </div>
	</div>
	
	{% if search %}

	<h3>{{ result|length }} Résultat{% if result|length > 1 %}s{% endif %} <small>{{ query }}</small></h3>
	
	<table class="table table-striped table-hover">	
	{% for item in result %}
	<tr style="cursor: pointer;" onclick="document.location.href='{{ path('contrat_visualisation', {'id': item.doc.id}) }}'">
                <td>{{ item.doc.typeContratLibelle }}<br /><small class="text-{{ item.doc.statutCouleur }}">{{ item.doc.statutLibelle }}</small></td>
                <td>
                n°&nbsp;<strong>{{ item.doc.numeroArchive }}</strong><br />
                {% for prestation in item.doc.prestations %}
                        {% if(prestation.wordToPicto) %}
                            &nbsp;<span class="" title="{{  prestation.nomToString }}" data-toggle="tooltip" >
                                <i class="mdi-{{prestation.wordToPicto}}">&nbsp;</i>&nbsp;<span>{{ prestation.nbPassages }}</span></span>
                            {% else %}
                            <span class="btn btn-xs label-primary">{{  prestation.nomToString }}&nbsp;<span>{{ prestation.nbPassages }}</span></span>
                        {% endif %}
                    {% endfor %}
                </td>
                <td>
                	{{ item.doc.dateDebut | localizeddate("medium", "none", null, null, "MMM YYYY") | capitalize }}{% if(item.doc.dateDebut | localizeddate("medium", "none", null, null, "MMM YYYY")) != item.doc.dateFin | localizeddate("medium", "none", null, null, "MMM YYYY") %}&nbsp;-&nbsp;{{ item.doc.dateFin | localizeddate("medium", "none", null, null, "MMM YYYY") | capitalize }}{% endif %}<br />
                	<small class="text-muted">{% if(item.doc.dureeGarantie) %}Garantie&nbsp;{{ item.doc.dureeGarantie }}&nbsp;mois{% else %}Aucune ganrantie{% endif %}</small>
                </td>
                <td>{{ "%0.2f" | format(item.doc.getPrixHt)  }}&nbsp;€<br />
                	<small>
                    {% if item.doc.etablissements | length >= 1 %}
                        {{ item.doc.etablissements | length }}&nbsp;établissement{% if item.doc.etablissements | length > 1 %}s{% endif %}
                    {% else %}
                        Aucun établissement
                    {% endif %}
                    </small>
                </td>
            </tr>
	{% endfor %}
	</table>

	{% endif %}
{% endblock %}
